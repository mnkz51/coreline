name: Gemini Auto Coder
on:
  push:
    paths:
      - 'SPEC.md'

jobs:
  code-gen:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Gemini AI Coding
        uses: google-github-actions/run-gemini-cli@v0
        with:
          gemini_api_key: ${{ secrets.GEMINI_API_KEY }}
          gemini_model: 'gemini-1.5-flash'
          prompt: |
            あなたは「Core-Line」というブラウザゲームのリード開発者です。
            
            【設計方針】
            1. 外部ライブラリ（グリッド用）は不使用。Red Blob Gamesの「Cube Coordinates」に基づいた自作のHex管理クラスを実装する。
            2. 描画は PixiJS を使用。
            3. ビルドツール（npm/webpack等）は使わず、ブラウザでそのまま動く「JavaScript (ES modules)」で記述してください。
            4. コードは index.html と script.js の2ファイルに分けて出力してください。
            5. ロジックと描画を分離し、将来的な機能拡張（自動化・物流）に耐えうるクリーンなコードを書いてください。
            
            【現在のタスク】
            SPEC.md の「現在の目標」を確認し、それを実現するための index.html および script.js の全内容を、それぞれマークダウンのコードブロック形式で出力してください。
          files: |
            SPEC.md
            index.html
            script.js

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          commit-message: "Update code based on latest SPEC.md"
          title: "Gemini: SPEC.mdの内容を反映しました"
          body: "スマホからの指示に基づき、AIがコードを生成しました。動作確認をお願いします。"
          branch: gemini-updates
          delete-branch: true
