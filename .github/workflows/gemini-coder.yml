name: Gemini Auto Coder
on:
  push:
    paths:
      - SPEC.md

jobs:
  code-gen:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Gemini AI Coding
        uses: google-github-actions/run-gemini-cli@v0
        with:
          gemini_api_key: ${{ secrets.GEMINI_API_KEY }}
          gemini_model: gemini-2.5-flash-lite
          upload_artifacts: true
          prompt: |
            あなたは「Core-Line」というブラウザゲームのリード開発者です。
            SPEC.md（および存在すれば blueprints/ 内の資料）に基づき、ゲームを更新してください。
            
            【出力先】
            以下のパスでコードを生成してください。
            - docs/index.html
            - docs/script.js
            
            【設計方針】
            1. 外部ライブラリ（グリッド用）は不使用。Red Blob Gamesの「Cube Coordinates」に基づいた自作のHex管理クラスを実装する。
            2. 描画は PixiJS を使用。
            3. ビルドツール（npm/webpack等）は使わず、ブラウザでそのまま動く「JavaScript (ES modules)」で記述してください。
            4. ロジックと描画を分離し、将来的な機能拡張（自動化・物流）に耐えうるクリーンなコードを書いてください。

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          commit-message: "Update code based on latest SPEC.md"
          title: "Gemini: SPEC.mdの内容を反映しました"
          body: "コードを生成しました。動作確認をお願いします。"
          branch: gemini-updates
          delete-branch: true
          add-paths: |
            docs/
            SPEC.md
            blueprints/
